// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

// model Admin {
//   id           String   @id @default(uuid())
//   name         String
//   email        String   @unique
//   password     String

//   // Necessary for secure JWT authentication (Logout/Refresh logic)
//   refreshToken String?

//   createdAt    DateTime @default(now())
//   updatedAt    DateTime @updatedAt

//   @@map("admins")
//   @@index([name])
//   @@index([createdAt])
//   @@index([name, createdAt])
// }

// // Single user table for all roles (including future owner login)
// model User {
//   id           String   @id @default(uuid())
//   firstName    String
//   lastName     String
//   email        String   @unique
//   password     String?
//   refreshToken String?
//   role         Role
//   isActive     Boolean  @default(false)   // ADD THIS LINE
//   createdAt    DateTime @default(now())
//   updatedAt    DateTime @updatedAt

//   salonUsers   SalonUser[]
//   ownerProfile OwnerProfile?
//   employeeProfile EmployeeProfile?
//   accountantProfile AccountantProfile?
// }

// enum Role {
//   SUPER_ADMIN
//   SALON_OWNER
//   EMPLOYEE
//   ACCOUNTANT
// }

// // Salon table
// model Salon {
//   id            String   @id @default(uuid())
//   name          String
//   businessType  String
//   vtaNumber     String   @unique
//   employeeCount String

//   email         String   @unique
//   phoneNumber   String

//   country       String
//   city          String
//   province      String
//   zipCode       String

//   trialPeriod   String
//   initialPlan   String

//   createdAt     DateTime @default(now())
//   updatedAt     DateTime @updatedAt

//   salonUsers    SalonUser[]
// }

// // Bridge table for multi-tenant relationship
// model SalonUser {
//   id       String @id @default(uuid())
//   userId   String
//   salonId  String

//   user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
//   salon    Salon  @relation(fields: [salonId], references: [id], onDelete: Cascade)

//   @@unique([userId, salonId])
//   @@index([salonId])
//   @@index([userId])
// }

// // Optional profile for owners
// model OwnerProfile {
//   id             String @id @default(uuid())
//   userId         String @unique
//   user           User   @relation(fields: [userId], references: [id], onDelete: Cascade)
//   invitationSent Boolean @default(false)
// }

// // Optional profiles for future employees/accountants
// model EmployeeProfile {
//   id          String @id @default(uuid())
//   userId      String @unique
//   user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
//   salary      Float?
//   designation String?
// }

// model AccountantProfile {
//   id            String @id @default(uuid())
//   userId        String @unique
//   user          User   @relation(fields: [userId], references: [id], onDelete: Cascade)
//   licenseNumber String?
// }

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -----------------
// Platform Admin
// -----------------
model Admin {
  id           String  @id @default(uuid())
  name         String
  email        String  @unique
  password     String
  refreshToken String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@index([createdAt])
  @@index([name, createdAt])
  @@map("admins")
}

// -----------------
// Users (Global Identity)
// -----------------
model User {
  id           String   @id @default(uuid())
  firstName    String
  lastName     String
  email        String   @unique
  password     String?
  refreshToken String?
  isActive     Boolean  @default(false) // Account active or not
  role         Role? // KEEP TEMPORARILY FOR SAFE MIGRATION
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  salonUsers        SalonUser[]
  ownerProfile      OwnerProfile?
  employeeProfile   EmployeeProfile?
  accountantProfile AccountantProfile?

  @@index([email])
}

// -----------------
// Role Enum (Platform / Tenant roles)
// -----------------
enum Role {
  SUPER_ADMIN
  SALON_OWNER
  EMPLOYEE
  ACCOUNTANT
}

// -----------------
// Salon (Tenant)
// -----------------
model Salon {
  id            String @id @default(uuid())
  name          String
  businessType  String
  vtaNumber     String @unique
  employeeCount String
  email         String @unique
  phoneNumber   String
  country       String
  city          String
  province      String
  zipCode       String
  trialPeriod   String
  initialPlan   String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // soft delete
  createdBy String? // optional audit
  updatedBy String? // optional audit

  salonUsers SalonUser[]
}

// -----------------
// Multi-Tenant Bridge: User â†” Salon
// -----------------
model SalonUser {
  id      String @id @default(uuid())
  userId  String
  salonId String
  role    Role? // NEW: Tenant-scoped role

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  salon Salon @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@unique([userId, salonId])
  @@index([salonId])
  @@index([userId])
  @@index([salonId, role])
}

// -----------------
// Optional Role Profiles
// -----------------
model OwnerProfile {
  id             String    @id @default(uuid())
  userId         String    @unique
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  invitationSent Boolean   @default(false)
  deletedAt      DateTime?
}

model EmployeeProfile {
  id          String    @id @default(uuid())
  userId      String    @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  salary      Decimal?  @db.Decimal(10, 2) // safer for finance
  designation String?
  deletedAt   DateTime?
}

model AccountantProfile {
  id            String    @id @default(uuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  licenseNumber String?
  deletedAt     DateTime?
}
